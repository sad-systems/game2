/*==============================================================================
 *  Title      : Game storage
 *  Author     : Digger (c) SAD-Systems <http://sad-systems.ru>
 *  Created on : 18.06.2016
 *==============================================================================
 */

var localStorage = require('localStorage'),
    stateStorage = require('stateStorage').getInstance();

var data = {
    
    //--- Game data:
    scene       : '',
    map         : null,
    positionX   : null,
    positionY   : null,
    collected   : [],
    firestate   : 0,
    gamestate   : {}
    
};

var storageName;

//==============================================================================
// Exports module values:
//==============================================================================

module.exports = {
    
    //set: function (name, value) {
    //    data[name] = value;
    //    localStorage.save(storageName, data);
    //},
    
    //get: function (name) {
    //    return data[name];
    //},
    
    save: function (gameName, playerInstance) {
        
        var collected = [];
        for (var i in playerInstance.collectedGoods) collected.push(playerInstance.collectedGoods[i].index);
        data = {
            positionX : playerInstance.player.x,
            positionY : playerInstance.player.y,
            collected : collected,
            firestate : playerInstance.fireState,
            scene     : stateStorage.currentSceneName,
            map       : stateStorage.currentMapName,
            gamestate : stateStorage.getStorage()
        };
        console.log(data);
        localStorage.save(gameName, data);
        
        //data['gamestate'] = stateStorage.getStorage();
        //localStorage.save(storageName, data);
    },
    
    load: function (gameName) {
        Phaser.Utils.extend(true, data, localStorage.load(gameName));
        return data;
    }

};