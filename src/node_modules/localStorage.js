/*==============================================================================
 *  Title      : Local Storage
 *  Author     : Digger (c) SAD-Systems <http://sad-systems.ru>
 *  Created on : 24.06.2016
 *==============================================================================
 */

var cookies = require('cookies');

//==============================================================================
// Exports module values:
//==============================================================================

module.exports = {

    defaultStorageName: 'default',

    /**
     * Save the session data
     * 
     * @param {string} name The sessions name
     * @param {object} data The sessions data
     */
    save: function (name, data) {
        
        name = name || this.defaultStorageName;
        
        var serialized = JSON.stringify(data); //console.log(serialized);
        
        if(typeof(window.localStorage) !== "undefined") {
            //--- Use HTML5 local storage:
            window.localStorage.setItem(name, serialized);
        } else {
            //--- Use cookies:
            cookies.create(name, serialized, 360);
        }
        
    },

    /**
     * Erase the session
     * 
     * @param {string} name The sessions name
     */
    erase: function (name) {
        
        name = name || this.defaultStorageName;
        
        if(typeof(window.localStorage) !== "undefined") {
            //--- Use HTML5 local storage:
            window.localStorage.removeItem(name);
        } else {
            //--- Use cookies:
            cookies.erase(name);
        }        
        
    },

    /**
     * Load the session
     * 
     * @param   {string} name The sessions name
     * @returns {object}      The sessions saved data
     */
    load: function (name) {
        
        name = name || this.defaultStorageName;
        
        var serialized;
        
        if(typeof(window.localStorage) !== "undefined") {
            //--- Use HTML5 local storage:
            serialized = window.localStorage.getItem(name);
        } else {
            //--- Use cookies:
            cookies.read(name);
        }
        
        return JSON.parse(serialized);
        
    }
    
};



